# Google Play Console セットアップガイド

MidLab を Google Play Store にリリースするためのステップバイステップガイド。
Google Play Developer アカウント登録済みの状態から開始します。

---

## ステップ 1: Google Play Console でアプリを作成

### 1-1. アプリの新規作成

1. [Google Play Console](https://play.google.com/console/) にログイン
2. ホーム画面で **「アプリを作成」** をクリック
3. 以下の情報を入力:

| 項目 | 入力値 |
|------|--------|
| アプリ名 | `MidLab` |
| デフォルト言語 | `日本語 — ja-JP` |
| アプリ / ゲーム | `アプリ` |
| 無料 / 有料 | `無料` |

4. デベロッパープログラムポリシーとアメリカ輸出法への同意にチェック
5. **「アプリを作成」** をクリック

---

## ステップ 2: ストアの掲載情報を入力

### 2-1. メインのストア掲載情報

左メニュー: **成長 > ストアの掲載情報 > メインのストア掲載情報**

#### アプリ名
```
MidLab（ミドラボ）
```

#### 短い説明（80文字以内）
```
ETPテストで最適な中距離トレーニングプランを自動生成。800m〜1500m走の記録向上をサポートします。
```

#### 詳細な説明（4000文字以内）
```
MidLab（ミドラボ）は、800m〜1500mの中距離走に特化したトレーニング管理アプリです。

■ ETPテストで現在の走力を測定
独自のETP（Endurance Training Pace）テストにより、あなたの現在の走力レベルを科学的に測定。テスト結果をもとに最適なトレーニングペースを自動算出します。

■ あなた専用のトレーニングプランを自動生成
ETPテストの結果に基づいて、あなたの走力レベルに合った週間トレーニングプランを自動生成。インターバル走、テンポ走、ペース走など、中距離走に必要な多彩なメニューを提案します。

■ ワークアウトを記録・管理
日々のトレーニング内容を簡単に記録。実施したワークアウトの履歴を確認して、トレーニングの進捗を把握できます。

■ データはあなたの端末に安全に保存
トレーニングデータはすべてあなたの端末内に保存されます。アカウント登録は不要。すぐにトレーニングを始められます。

【プレミアムプラン】
・月額プラン: ¥980/月
・年額プラン: ¥9,800/年（月あたり¥817、2ヶ月分おトク）
・初回1週間無料トライアル

プレミアムプランでは、詳細なトレーニングプランの生成、高度な分析機能をご利用いただけます。

【サブスクリプションについて】
・お支払いはGoogle Playアカウントに請求されます
・無料トライアル期間終了後に自動的に課金が開始されます
・サブスクリプションは自動更新されます
・解約は端末の設定 > サブスクリプション管理から行えます
・現在の期間終了の24時間前までに解約しない限り自動更新されます

プライバシーポリシー: https://myajiri.github.io/midlab/privacy.html
利用規約: https://myajiri.github.io/midlab/terms.html
```

### 2-2. グラフィック素材

| 素材 | 要件 | 備考 |
|------|------|------|
| **アプリアイコン** | 512 x 512 px, PNG, 32ビット, 1MB以下 | Google Play Console 用（EAS Build で生成されるものとは別途） |
| **フィーチャーグラフィック** | 1024 x 500 px, PNG or JPEG | ストアページのヘッダーに表示される |
| **スクリーンショット** | 最低2枚、最大8枚, 1080 x 1920 px以上推奨 | 主要画面をキャプチャ |

#### 推奨スクリーンショット構成（5〜6枚）
1. **オンボーディング画面** — プロフィール設定
2. **ホーム画面** — 今日のトレーニング概要
3. **ETPテスト画面** — テスト実行中 or 結果
4. **トレーニングプラン画面** — 週間プラン一覧
5. **ワークアウト記録画面** — 記録入力
6. **アップグレード画面** — プレミアムプラン紹介

> **Tip:** スクリーンショットは `eas build --profile testing --platform android` でビルドしたAPKをエミュレーターか実機にインストールし、画面キャプチャする。Maestro の `.maestro/store_screenshots.yaml` を使うと自動キャプチャも可能。

### 2-3. 連絡先情報

| 項目 | 入力値 |
|------|--------|
| メールアドレス | `myajiri@gmail.com` |
| ウェブサイト | `https://myajiri.github.io/midlab/` |
| 電話番号 | （任意） |

---

## ステップ 3: アプリのコンテンツを設定

### 3-1. コンテンツのレーティング

左メニュー: **ポリシー > アプリのコンテンツ > コンテンツのレーティング**

1. **「アンケートを開始」** をクリック
2. メールアドレスを確認: `myajiri@gmail.com`
3. カテゴリ: **「ユーティリティ、仕事効率化、コミュニケーションなど」** を選択
4. 以下の質問にすべて **「いいえ」** と回答:

| 質問 | 回答 |
|------|------|
| 暴力的なコンテンツが含まれますか？ | いいえ |
| 性的なコンテンツが含まれますか？ | いいえ |
| マリファナへの言及がありますか？ | いいえ |
| 言葉遣いに問題はありますか？ | いいえ |
| ギャンブル要素がありますか？ | いいえ |
| ユーザー間のコミュニケーション機能がありますか？ | いいえ |
| ユーザーの位置情報を共有しますか？ | いいえ |
| デジタル商品の購入ができますか？ | はい（サブスクリプション） |

5. **「レーティングを適用」** をクリック
6. 期待される結果: **IARC 3+（全年齢）**

### 3-2. ターゲットユーザー層

左メニュー: **ポリシー > アプリのコンテンツ > ターゲットユーザー層**

1. 対象年齢: **「13歳以上」** を選択
   - 13歳未満を対象外にすることで COPPA 対応が不要
2. 子供向けではないことを確認

### 3-3. データセーフティ

左メニュー: **ポリシー > アプリのコンテンツ > データセーフティ**

以下のように回答:

#### 概要
| 質問 | 回答 |
|------|------|
| アプリで必要なユーザーデータの種類を収集または共有しますか？ | **はい** |
| アプリで収集するデータはすべて転送中に暗号化されますか？ | **はい**（HTTPS） |
| ユーザーがデータの削除をリクエストする方法はありますか？ | **はい**（アプリのアンインストールで全データ削除） |

#### データの種類ごとの回答

**「財務情報」> 「購入履歴」のみ「収集する」にチェック:**

| 項目 | 回答 |
|------|------|
| データは収集されますか、それとも共有されますか？ | **収集のみ** |
| このデータはオプションですか、必須ですか？ | **オプション**（無料でも利用可能） |
| このデータの収集目的は？ | **アプリの機能**、**分析** |
| このデータは処理のために送信されますか？ | **はい**（RevenueCat に送信） |

**その他のデータタイプはすべて「収集しない」:**
- 個人情報（名前、メール等）: 収集しない
- 位置情報: 収集しない
- 健康とフィットネス: 収集しない（端末ローカルに保存のみ）
- メッセージ: 収集しない
- 写真と動画: 収集しない
- 音声: 収集しない
- ファイルとドキュメント: 収集しない
- カレンダー: 収集しない
- 連絡先: 収集しない
- アプリのアクティビティ: 収集しない
- ウェブ閲覧: 収集しない
- デバイスまたはその他の ID: 収集しない

### 3-4. 広告

左メニュー: **ポリシー > アプリのコンテンツ > 広告**

- **「いいえ、アプリに広告は含まれません」** を選択

### 3-5. アプリへのアクセス

左メニュー: **ポリシー > アプリのコンテンツ > アプリへのアクセス**

- **「すべての機能は特別なアクセスなしで利用可能」** を選択
  - （アカウント登録不要のため）

### 3-6. プライバシーポリシー

左メニュー: **ポリシー > アプリのコンテンツ > プライバシーポリシー**

```
https://myajiri.github.io/midlab/privacy.html
```

---

## ステップ 4: Service Account の設定

Google Play Console から EAS Submit でアプリを自動提出するために必要。

### 4-1. Google Cloud Console でサービスアカウントを作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 画面上部のプロジェクトセレクタから **「新しいプロジェクト」** を作成（またはMidLab用の既存プロジェクトを選択）
   - プロジェクト名: `MidLab`
3. 左メニュー: **IAM と管理 > サービスアカウント**
4. **「サービスアカウントを作成」** をクリック
5. 以下を入力:

| 項目 | 入力値 |
|------|--------|
| サービスアカウント名 | `midlab-play-publish` |
| サービスアカウント ID | `midlab-play-publish`（自動生成） |
| 説明 | `MidLab Google Play 公開用` |

6. **「作成して続行」** → 役割は不要 → **「完了」**

### 4-2. JSON キーを生成

1. 作成したサービスアカウント `midlab-play-publish` をクリック
2. **「鍵」** タブ → **「鍵を追加」** → **「新しい鍵を作成」**
3. キータイプ: **JSON** を選択
4. **「作成」** → JSON ファイルが自動ダウンロード
5. ダウンロードしたファイルを **プロジェクトルートに `google-play-service-account.json` として保存**

```bash
# ファイルが .gitignore に含まれていることを確認（設定済み）
cat .gitignore | grep google-play
# → google-play-service-account.json
```

### 4-3. Google Play Console で API アクセスを設定

1. Google Play Console にログイン
2. 左メニュー: **設定 > API アクセス**
3. **「Google Cloud プロジェクトをリンク」** をクリック
4. 先ほど作成したプロジェクト `MidLab` を選択してリンク
5. **「サービスアカウント」** セクションで、`midlab-play-publish` が表示されていることを確認
6. **「アクセス権を管理」** をクリック
7. 権限を付与:
   - **「アプリの情報の閲覧、作成、編集」** にチェック
   - **「リリースの管理、公開」** にチェック
   - **「アプリの署名の管理」** は不要

8. **「変更を保存」**

> **注意:** API アクセスの権限が反映されるまで数分〜数時間かかる場合があります。

---

## ステップ 5: 定期購入（サブスクリプション）の作成

### 5-1. Google Play Console で収益化を有効化

左メニュー: **収益化 > 商品 > 定期購入**

### 5-2. 月額プランの作成

**「定期購入を作成」** をクリック:

| 項目 | 入力値 |
|------|--------|
| 商品 ID | `midlab_premium_monthly` |
| 名前 | `MidLab プレミアム 月額` |
| 説明 | `詳細なトレーニングプラン生成、高度な分析機能を利用できます。` |

**基本プランを作成:**

1. **「基本プランを追加」** をクリック
2. 基本プラン ID: `monthly-base`
3. 請求期間: **1か月**
4. 自動更新: **有効**
5. 猶予期間: **3日**（推奨）
6. アカウントの一時停止: **有効**（推奨）

**価格を設定:**
- 日本（JPY）: **¥980**
- その他の国: 自動変換を使用

**特典（無料トライアル）を追加:**
1. **「特典を追加」** をクリック
2. 特典 ID: `monthly-free-trial`
3. フェーズ 1:
   - タイプ: **無料トライアル**
   - 期間: **1週間**
4. 有効化の条件: **対象となるアプリで初めて定期購入する場合のみ**

5. **「有効化」** をクリック

### 5-3. 年額プランの作成

**もう一度「定期購入を作成」** をクリック:

| 項目 | 入力値 |
|------|--------|
| 商品 ID | `midlab_premium_yearly` |
| 名前 | `MidLab プレミアム 年額` |
| 説明 | `詳細なトレーニングプラン生成、高度な分析機能を利用できます。月あたり¥817で2ヶ月分おトク。` |

**基本プランを作成:**

1. **「基本プランを追加」** をクリック
2. 基本プラン ID: `yearly-base`
3. 請求期間: **1年**
4. 自動更新: **有効**
5. 猶予期間: **7日**（推奨）
6. アカウントの一時停止: **有効**（推奨）

**価格を設定:**
- 日本（JPY）: **¥9,800**
- その他の国: 自動変換を使用

**特典（無料トライアル）を追加:**
1. **「特典を追加」** をクリック
2. 特典 ID: `yearly-free-trial`
3. フェーズ 1:
   - タイプ: **無料トライアル**
   - 期間: **1週間**
4. 有効化の条件: **対象となるアプリで初めて定期購入する場合のみ**

5. **「有効化」** をクリック

### 5-4. テスト用ライセンスアカウントの追加

1. Google Play Console 左メニュー: **設定 > ライセンステスト**
2. **「テスター用のGmailアカウントを追加」** に自分のGmailアドレスを入力
3. ライセンスの応答: **「LICENSED」** を選択
4. **「変更を保存」**

> テスト用ライセンスアカウントで購入すると、実際の請求は発生しません。

---

## ステップ 6: RevenueCat の設定

### 6-1. RevenueCat アカウント・プロジェクト作成

1. [RevenueCat](https://www.revenuecat.com/) にアクセスし、アカウントを作成
2. ダッシュボードで **「+ New Project」** をクリック
3. プロジェクト名: `MidLab`

### 6-2. Google Play アプリを追加

1. プロジェクト設定で **「+ New App」** をクリック
2. プラットフォーム: **Google Play**
3. アプリ名: `MidLab`
4. Package Name: `com.midlab.app`

### 6-3. Google Play Service Account を登録

1. RevenueCat ダッシュボード: **Project Settings > Service Accounts**
2. **「Add Service Account Credentials」** をクリック
3. `google-play-service-account.json` の中身をペースト、またはファイルをアップロード
4. **「Save」**

### 6-4. プロダクトの設定

1. 左メニュー: **Products**
2. **「+ New Product」** をクリックして2つのプロダクトを追加:

**月額プロダクト:**
| 項目 | 入力値 |
|------|--------|
| App | MidLab (Google Play) |
| Product Identifier | `midlab_premium_monthly` |

**年額プロダクト:**
| 項目 | 入力値 |
|------|--------|
| App | MidLab (Google Play) |
| Product Identifier | `midlab_premium_yearly` |

### 6-5. エンタイトルメントの設定

1. 左メニュー: **Entitlements**
2. **「+ New Entitlement」** をクリック
3. Identifier: `MidLab Pro`
4. **「Add」**
5. 作成したエンタイトルメント `MidLab Pro` をクリック
6. **「Attach Product」** で上記2つのプロダクトを紐付け:
   - `midlab_premium_monthly`
   - `midlab_premium_yearly`

> **重要:** エンタイトルメント ID は `MidLab Pro` と正確に入力してください。アプリのコード（`lib/purchases.ts`）でこの ID を使用しています。

### 6-6. Offering の設定

1. 左メニュー: **Offerings**
2. デフォルトの `default` Offering をクリック
3. **「+ New Package」** で以下のパッケージを追加:

**月額パッケージ:**
| 項目 | 入力値 |
|------|--------|
| Package Type | `Monthly ($rc_monthly)` |
| Product | `midlab_premium_monthly` |

**年額パッケージ:**
| 項目 | 入力値 |
|------|--------|
| Package Type | `Annual ($rc_annual)` |
| Product | `midlab_premium_yearly` |

### 6-7. API キーを取得

1. RevenueCat ダッシュボード: **Project Settings > API Keys**
2. **Google Play** 用の Public API Key をコピー（`goog_` で始まる文字列）

### 6-8. EAS Secrets に API キーを登録

```bash
# RevenueCat の Android API キー
eas secret:create --name EXPO_PUBLIC_REVENUECAT_API_KEY_ANDROID --value "goog_xxxxxxxxxxxxxxxx"
```

> コード参照: `app.config.js` の `extra.revenueCatApiKeyAndroid` → `lib/purchases.ts` で使用

---

## ステップ 7: ビルドと提出

### 7-1. テスト用ビルド（プレミアム機能アンロック済み）

```bash
# 課金UIスキップ・全プレミアム機能アンロック状態でビルド
eas build --profile testing --platform android
```

- APK 形式で出力（実機・エミュレーターに直接インストール可能）
- テスターへの配布用

### 7-2. テスト項目の確認

`ANDROID_RELEASE_CHECKLIST.md` のテスト項目を参照。主要なチェック項目:

- [ ] オンボーディングフロー（プロフィール → PB入力 → ETP算出）
- [ ] ホーム画面の表示
- [ ] ETPテストの実行・記録
- [ ] トレーニングプラン生成
- [ ] ワークアウト記録
- [ ] 設定画面の全項目
- [ ] ハードウェアバックボタンの動作
- [ ] 各種画面サイズでのレイアウト確認
- [ ] オフライン状態での動作

### 7-3. 本番ビルド（AAB 形式）

```bash
# Google Play 提出用 AAB ファイルをビルド
eas build --platform android --profile production
```

### 7-4. 内部テストトラックに提出

```bash
# Google Play Console の内部テストトラックに提出
eas submit --platform android --profile production
```

`eas.json` の設定により:
- `track: "internal"` → 内部テストトラックに公開
- `releaseStatus: "draft"` → 下書き状態でアップロード

### 7-5. サブスクリプションテスト

1. 内部テストトラックにテスターを追加
2. ライセンステストアカウントでアプリをインストール
3. 以下を確認:
   - [ ] アップグレード画面の表示
   - [ ] 月額/年額プラン選択
   - [ ] 購入フローの完了
   - [ ] 購入後の Premium 機能アンロック
   - [ ] 購入復元
   - [ ] Google Play サブスクリプション管理への遷移

---

## ステップ 8: 公開

### 8-1. 段階的な公開

```
内部テスト → クローズドテスト → オープンテスト → 製品版
```

1. **内部テスト**: 最大100名の内部テスターで動作確認
2. **クローズドテスト**: 指定したユーザーグループに公開
3. **オープンテスト**（任意）: 誰でも参加可能なベータテスト
4. **製品版**: 一般公開

### 8-2. 製品版に公開する際の変更

`eas.json` の `submit.production.android` を更新:

```json
{
  "track": "production",
  "releaseStatus": "completed"
}
```

---

## クイックリファレンス

### アプリの基本情報

| 項目 | 値 |
|------|-----|
| アプリ名 | MidLab |
| パッケージ名 | `com.midlab.app` |
| カテゴリ | ヘルスケア / フィットネス |
| 価格 | 無料（アプリ内購入あり） |
| デフォルト言語 | ja-JP |
| 連絡先メール | myajiri@gmail.com |
| プライバシーポリシー | https://myajiri.github.io/midlab/privacy.html |
| 利用規約 | https://myajiri.github.io/midlab/terms.html |
| サポート URL | https://myajiri.github.io/midlab/ |

### サブスクリプション商品

| 商品 ID | プラン | 価格 | 無料トライアル |
|---------|--------|------|---------------|
| `midlab_premium_monthly` | 月額 | ¥980 | 1週間 |
| `midlab_premium_yearly` | 年額 | ¥9,800 | 1週間 |

### RevenueCat 設定値

| 項目 | 値 |
|------|-----|
| エンタイトルメント | `MidLab Pro` |
| Offering | `default` |
| Monthly パッケージ | `$rc_monthly` → `midlab_premium_monthly` |
| Annual パッケージ | `$rc_annual` → `midlab_premium_yearly` |

### EAS コマンド一覧

```bash
# テスト用ビルド（APK、課金スキップ）
eas build --profile testing --platform android

# 本番ビルド（AAB）
eas build --platform android --profile production

# 内部テストトラックに提出
eas submit --platform android --profile production

# RevenueCat API キー登録
eas secret:create --name EXPO_PUBLIC_REVENUECAT_API_KEY_ANDROID --value "goog_xxx"
```
